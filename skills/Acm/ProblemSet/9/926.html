<HTML>
<HEAD>
<TITLE>MIUP'2004: Problem G</TITLE>
</HEAD>

<BODY bgcolor="white">

<font color="#006000">
<H1>Problem G</H1>

<H1 align="center">Walking Around Wisely</H1>
</font>

<P align="left">
<p align="left"><img src="p926.jpg" align="right" width="500" height="270"><fontcolor="#000000">
Imagine you are in a well planned city in which a very large area has
all streets or avenues set nicely in a perpendicular way resembling a
grid. For a real example consider Downtown Manhattan in New
York. Obviously, there may be cases in which a street or avenue is
suddenly discontinued. For you, streets or avenues are the same and to
simplify we call them roads. You can always walk in any direction
along a road (either North/South or East/West).

<P align="left"> We have a small challenge for you. As illustrated
in the figure, we want you to determine in how many ways can
you go from a start position <i>A</i> to an end position <i>B</i>. By
<i>position</i> we mean a crossing between two roads. There is a small
catch, you are not allowed to travel South or West.

<FONT color="#006000"><H2>Problem</H2></FONT>

<P align="left"> 

Given a grid of <i>NxN</i> roads, a starting position
<i>A=(A<sub>x</sub>,A<sub>y</sub>)</i> and a ending position
<i>B=(B<sub>x</sub>,B<sub>y</sub>)</i>, your task is to count in how
many ways can you go from <i>A</i> to <i>B</i> without ever travelling
South or West. You can assume that there will always be at least one
valid path between the start and the end positions.


<FONT color="#006000"><H2>Input</H2></FONT>

<P align="left">

<P align="left"> The first line of input contains <i>C</i> (<i>0 &lt;
C &lt; 1000</i>), the number of test cases that follows.

<P align="left"> 
Each test case starts with a line containing the
number <i>N</i> (<i>1 &lt; N &lt;= 30</i>) of vertical and horizontal
roads, followed by two lines containing the start position and the end
position. Each position is defined by two integer coordinates
separated by a single space.

<P align="left"> The next line contains the number of places,
<i>W</i> (limited by the size of the grid), where the roads are
discontinued. The following <i>W</i> lines, describe such places. Each
place is defined by two integer coordinates 
<i>P<sub>x</sub></i> and <i>P<sub>y</sub></i> (road numbers between
<i>1</i> and <i>N</i>) followed by a symbol
<i>D</i> (<i>D in {N,E,S,W}</i>) indicating that there are men working
in the direction
<i>D</i> with respect to junction
<i>(P<sub>x</sub>,P<sub>y</sub>)</i>. The three values that
characterize a place are separated by a single space.

<FONT color="#006000"><H2>Output</H2></FONT>

<P align="left">
For each input case your program must output a line indicating the
number of ways you can go from the start to the end point, given that
you are not allowed to travel South or West.

<FONT color="#006000"><H2>Sample Input</H2></FONT>

The first test case illustrates the figure.

<PRE>
2
3
1 1
3 3
2
2 3 S
2 2 W
3
1 1
3 3
0
</PRE>
<FONT color="#006000"><H2>Sample Output</H2></FONT>
<PRE>
3
6
</PRE>
<HR>
<FONT SIZE=4>
<center>MIUP’2004: Fourth Portuguese National Programming Contest
</center>
</FONT>
<HR></font>Problem setter: Fernando Silva



</BODY>
</HTML>
